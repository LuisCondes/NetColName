function [y1] = NeuralNetworkSRGB(x1)
% [y1] = NeuralNetworkSRGB(x1) takes these arguments:
%   x = 3xQ matrix, input #1
% and returns:
%   y = 11xQ matrix, output #1
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [-90;64;52];
x1_step1_gain = [0.00579710144927536;0.0109289617486339;0.0103092783505155];
x1_step1_ymin = -1;

% Layer 1
b1 = [-4.6022581845869199;-4.0681604219410277;3.811943909249512;0.26080496384944069;1.8479687659349038;-5.1535427094686339;5.2323184305414392;2.714588234586389;-3.8995856178573622;-1.1356284135353862;-0.56235724735782289;4.7975574394622145;2.5590192418021944;-4.4899370688106011;0.36961294322228389;-5.1591565617144086;0.6020136944782013;-2.6075910614608988;2.7560901412049255;-3.7288612524335676;-9.9132275535667063;-2.8892513844116539;-2.7623989513370915;-0.33334458757732205;2.4727891113285487;-4.8709070817365134;-0.51560196937337133;-3.4974756703776664;0.79811443559227235;0.54503267442971315;-0.23898419617235567;-3.0497961010684422;-0.3065144079299747];
IW1_1 = [10.586706298791364 -6.5698095227300097 0.8886797913650466;9.1117444921537363 -7.5522329906189993 2.825583709769151;-5.7423027760079854 1.6975454129836325 0.56951608496799222;-0.1284513449322916 2.0014221974652315 -3.3623608084017196;0.25931211448050728 -1.3973937439508433 -1.2432671514509304;3.5710871991596038 2.8292229780082558 -1.2161644996185486;-7.394234495276919 2.5241367146503446 0.91707292585750133;-3.1255191659174177 -3.759608931010721 4.3448110831020061;4.3642183035212545 -2.2303786683350406 1.0052047466078251;-0.02404963527125567 -6.0533178633697302 7.7642396329713419;2.5478933888422306 -2.2655311921200547 2.3441158798301238;-6.8153108340414317 11.147223101471152 -7.6848664952404269;-2.4380043015113224 -3.945416480270898 4.2932515629233263;2.7689754695007416 -1.438660010772439 5.3038129519354573;0.72266145912103252 1.1232777744191345 -3.7703545422275924;12.230890641994582 -7.4305665638726461 1.240210768959489;-0.99371003417261172 7.5345030586940176 -6.8110575813743548;4.0709590573688352 -7.2048905884431633 4.5683612119958603;-6.4342864583961434 5.0342971199679045 -0.32823911332429756;2.0182437669603015 4.0103211957935621 -0.32181300157841847;3.6967381842473688 2.1884003560689664 3.9370590337940485;4.7492767080362874 -1.2142610521478825 -0.20449157364906004;3.9193845338894193 -0.99748688971504862 0.13667943386872045;-1.4180133452381709 -2.2726716375748857 3.4324110571952984;-1.2758743927561944 1.0685479934200519 -2.9613906601359554;12.25458217856691 -10.979775930760344 4.5508512260251743;0.91343495481850456 -5.5009101845334678 5.3177117979528559;6.8640608396483112 1.7127370391066983 -4.3930361490978704;-1.4048483938694627 0.0038449291431013419 -1.9170133118131572;-2.8554637035364405 3.1006581188354163 -2.3976656190606964;-1.7884345326004845 -2.5903660749318282 3.0907506137623817;7.1208757623793062 -6.3892160120364467 0.49236952886372287;-1.0167908012890439 -1.6083786922496086 3.5389749604907776];

% Layer 2
b2 = [-0.74054629810183525;-1.1414039071160298;-1.3541055409744984;-0.57216217956707482;-0.32969965340478541;-0.28786430144769054;-0.35244176835246754;-1.0744416928402167;0.38227017322974083;-4.6991978774944965;1.334618015781275];
LW2_1 = [-0.12439727243263971 0.025574358751837115 0.1830053533179167 1.1904421974601638 -0.18365845485536586 0.081442538192411207 -0.045895157286516719 -0.74889337199754968 0.49476119963293341 -0.19460909866675874 0.81066327309225295 -0.31574042589969753 0.75396203775075454 0.038451133232201819 -0.83888508567869791 0.13421318405608654 0.44929027130000093 -0.37301183817412942 -0.09226005787079726 0.016305793194661675 -0.055414107622684575 0.087510894534784681 -0.13952344683223447 0.52166839846146307 0.28445230901784652 -0.032053466498644059 1.1593070155560916 -0.062835698471051818 0.30013713066689379 0.5056190459267712 -0.31252075231435839 -0.059822822073586218 -0.45435697743090814;0.70209641979017468 0.071445873161953222 1.0745870793801193 0.2998027911927067 -0.43759574076930863 -0.052375967738177792 -0.57358703091706331 1.4304505145629098 -1.0864459275837308 0.087095378172136168 0.41720911406632405 0.079828755495668785 -1.5703670641833247 0.04074360852807412 -0.13195920912801717 -0.75863518947830444 -0.05119477403381998 -0.11348337069899433 0.40897427722454394 -0.38572262415569192 -0.21110625539957739 -0.074735113673466802 2.109510390331093 -0.17184005447124209 0.32251300375558689 0.12902888997721249 -0.34229258659264711 -0.056633500214913569 0.24239741378822358 0.055606928417290459 0.352457216604045 0.33807225830730098 0.16293718891334724;2.4916832174307948 -1.1530732766396414 -1.5242545982475817 0.31757833999197971 -0.3248147451399982 -0.3189125417539404 0.49326420063004034 -0.086126514860674297 0.84936035876025795 0.032181331512073821 -1.5906985081139586 -0.12918864214338041 0.38524088330803136 0.57346568727639158 -0.31119113857223102 -0.79812477626831846 0.1635761061325364 -0.086136853368258298 2.7587506929426535 0.19789125155091075 -0.002808683187282837 0.15504974714232245 -2.390820027463183 1.3412681149183796 1.324155538761939 0.83600236946655648 -0.17701318906267594 0.36362570169667308 -0.41155399777389645 -1.5980334038595914 -0.70522780725047507 1.5055941255166225 -0.47255919340623237;-0.69833754345967214 -0.37822468216794181 -1.462308682328463 0.10298106355570096 -0.041677665485505652 0.8310234815295009 0.6152698302917603 0.2367497767561563 -0.026276071360683783 0.020286518102516048 -0.39414930670639531 -0.066958429838659392 -0.27021031280266206 -0.0010842191104336965 -0.18380170892535119 0.77059607549222064 0.0084546095018860918 0.13958607853204341 -0.79072637150632963 0.1276448965475111 -0.5117352775425239 -0.91968234117798098 0.15729136013546449 0.84186341345999383 0.18961814723417605 -0.0076025483271642408 0.0074464138540732373 -0.10703929878236704 -0.10347964329851125 -0.39537309597973602 -0.46486781664488558 -0.64463198525244081 -0.57125032204436077;-1.7337561616627966 1.6898952087014527 2.8433981068578533 -0.98104815212955043 1.7522272807521837 -0.36583834951465083 -1.2370272488729741 0.48188109165835985 0.42679190358187413 -0.49085411353813707 0.93140558079322733 -0.56077930442581192 -0.46565173542838612 -0.40244239367972484 0.81012936122811818 0.4476134977671517 -0.61505154705934106 -0.67031898798802703 -1.4036298766610629 0.2161253932866071 0.71376987902276468 1.2774664057030247 -0.35373969079323325 -2.5348841871368215 -2.0307336374405751 -1.4089606958534724 -1.2202659591838307 0.063940808098687352 0.43561494894105252 0.65788668843580766 1.1670588926433312 -0.77677442866177915 1.4801599727930841;1.7236710054945807 -0.99806652973789223 -3.0571565473563762 1.3868068686214601 -1.8382420650877802 -0.34350532659821881 1.1833966498494375 -0.64229169355682125 -0.64316236175496078 0.67776725486266665 -1.5308100582650515 -0.28428068242203042 0.78414059621596377 0.5323510000299605 -1.4430077538317858 -1.4012748626622451 1.3848853712883453 -0.10231090285918171 1.0841322810070757 -0.19550982309654469 0.10070453868481442 -1.8415147296889416 0.81723304819468645 3.7083512968031114 2.1476671207061351 0.5330161109992988 1.7486286134448012 0.16149826602889142 -0.52823700472565571 -1.4554932455109197 -1.2317478645157454 0.44107177348367493 -2.7581800252071331;2.0211198219453097 0.81624084763329396 5.2061873433261274 -0.080612204659784706 -0.76717009147826087 1.1596431100724001 -1.6230992730027973 0.021051902525912901 0.43326422952966837 -0.090844472075368637 -0.40495634410561304 -0.53325355677919917 -0.40880403790110098 0.23070054876141094 -0.25041270659477249 -1.5431941775132847 0.59158062355065322 -0.23570023449733637 0.11374983520819547 -0.62259516016430705 -0.63353773979619399 3.817189378580192 -0.98731911646286341 1.3268231699148483 0.62572958137115509 -0.56472664207739842 0.62034075504131803 -0.4938268651528725 0.0028664616875083712 -0.41955712283237212 -0.32901113591529518 -0.1133697770906382 -1.2399252711449427;-1.3268895538505405 0.63113613187666873 -4.8639506988149712 -1.5175367413058012 1.198003599362566 -0.99324003242129921 1.815842910211114 -0.40780981699157243 -0.512905037438526 0.12955555809357053 -0.28131135628047266 0.23697418694741171 0.63706286374999321 -0.17358804721040894 1.0879348864841443 0.6842265567015724 -0.47678700886809378 0.2701621885005947 -1.1193943694059525 0.58136468336393032 0.36386559663082901 -3.6744429651321764 1.1976953442701981 -1.3800617228166743 -1.1082324516866324 -0.43127642998280802 -0.64010208727491091 0.30802155541626997 -0.44968577601101184 0.4359091901981611 0.45335395446797849 -0.54926326901540024 0.76364094384687009;-0.26472688837707031 -0.031702836497391147 -0.34409696400210632 0.38463440015100175 -1.9275305186310814 0.019105392454103136 0.22537986947082289 0.34581816615988487 0.28902380631957292 -0.075306929983264159 -1.0846658842903913 0.21398462043052729 -0.61185305405923396 0.27629364293200603 -0.31831143239521831 -0.078540312951863547 -0.022802907168672122 0.56713109420243013 -1.576326929331068 -0.22139241577631266 -0.037579592013490079 -0.29459849108466596 0.12849462181828042 -0.87427415497123784 1.2821226126794343 0.17724236632039317 0.24020095717821055 -0.2339977338657209 -0.65593329225007435 -0.33449042270988266 0.87466502676805935 -1.065304494702076 -0.099225116984431622;-2.9946755974158399 -0.55614123049909425 1.9481403085285314 -1.1111178942984463 2.4698911304560576 -0.019069205076769489 -0.85804160712184141 -0.60380595330640752 -0.33100320450005999 -0.094076315533370022 3.2886748178828933 1.4314462727399915 0.75534185990194924 -1.4042918288033051 1.7528255276789746 2.6551003071901733 -1.510958059361637 0.65571075435835358 0.50590373564346891 0.30016626846831496 -2.0902085418314518 1.4182539603589046 -0.40684455984063445 -2.990137461220487 -3.5154089563762874 0.69771130300888273 -1.4770969969983785 0.069355676215941034 1.2472876027843398 2.7245951309664043 0.24615309378462769 0.90166791247380684 3.4974259596297883;0.21475828794937635 -0.12664279138886333 -0.012065179417632625 0.02281216673361772 0.080383334406693638 0.017242736577361188 0.001569568102048351 0.025906762540812107 0.083293276447041029 0.00075212940185460681 -0.17281421957240223 -0.074316656392301186 -0.050917783563963266 0.31556906941077584 -0.20159545823581002 -0.1213571321200025 0.081091139360680395 -0.052740715089613421 0.09797480351717372 -0.023771930835284328 2.5064822749490112 0.018359686571115131 -0.070565659037268608 0.2415688948587445 0.53604327540734764 0.079187422873189597 0.076222165455922211 -0.019349471138543239 -0.084175133633157886 -0.19482326008940781 -0.050135271211239195 0.011335020419552026 -0.3491800365986617];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = [2;2.06185567010309;2;2.04081632653061;2;2;2;2;2.01005025125628;2;2.11640211640212];
y1_step1_xoffset = [0;0;0;0;0;0;0;0;0;0;0];

% ===== SIMULATION ========

% Dimensions
Q = size(x1,2); % samples

% Input 1
xp1 = mapminmax_apply(x1,x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = repmat(b2,1,Q) + LW2_1*a1;

% Output 1
y1 = mapminmax_reverse(a2,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);

% Normalize output
%y1 = 1.9212 / (y1 + 0.4528); 
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
